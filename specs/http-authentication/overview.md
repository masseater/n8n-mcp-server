# HTTP Mode Authentication

## 目的
HTTPモードでMCPサーバーをホスティングする際に、クライアント（AIツール）からn8n API認証情報（API Key）をリクエストヘッダーで受け取り、動的にn8nへの認証を行えるようにする。これにより単一のn8nインスタンスに対して複数のアカウント（API Key）からのアクセスに対応可能なマルチテナント対応を実現する。

## スコープ
### 含まれるもの
- POST /mcpエンドポイントでクライアントからn8n API Key（X-N8N-API-KEY等のヘッダー）を受け取る仕組み
- リクエストごとにn8nクライアントを動的に初期化する機能（API Keyのみ動的、エンドポイントURLは固定）
- n8n認証失敗時のエラーハンドリング
- 環境変数N8N_API_KEYの廃止（N8N_URLは引き続き環境変数で設定）
- クライアントから送信すべきヘッダー仕様のドキュメント化

### 含まれないもの
- MCPエンドポイント自体の認証機能（Basic認証、API Key認証など）
- stdio transportの変更（stdioは既存仕様のまま）
- GET /healthエンドポイントの変更
- レート制限・DDoS対策（将来的な拡張として別タスクで検討）
- 複雑なユーザー管理機能（複数ユーザー、権限管理など）

## 想定される成果物
- リクエストヘッダーからn8n認証情報を抽出する機能
- リクエストごとにN8nApiClientを動的に初期化する実装
- 認証失敗時の適切なエラーレスポンス
- テストコード（ヘッダーなし、無効な認証情報、正しい認証情報のケース）
- CLAUDE.mdへのクライアント側実装ガイド追加（必要なヘッダー仕様など）

---

**次のステップ**: `/sdd:plan-implementation http-authentication` で実装概要と調査項目を特定してください
